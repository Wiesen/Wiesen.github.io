+++
date = "2016-01-11T21:31:20+08:00"
draft = true
title = "Paxos与Raft的区别"

tags = ["Distributed System"]
+++

##Introduction##

分布式一致性协议（distributed consensus protocol）是迄今为止最有效的解决服务器不可靠问题的途径，因为它使得一组服务器形成一个相互协同的系统，从而当其中部分服务器故障后，整个系统也能够继续工作。而Paxos协议几乎成了分布式一致性协议的代名词。

Raft的一个最重要的限制是要求顺序性，就是说paxos instance之间额外的又加了一层约束关系。也正是Raft的定位，决定了他不一定适用于大规模集群，要求单机QPS/TPS百万的分布式数据库系统。 

Raft有一个很强的假设是主（leader）和备（follower）都按顺序投票，为了便于阐述，以数据库事务为例：
·主库按事务顺序发送事务日志
·备库按事务顺序持久化事务和应答主库
·主库按事务顺序提交事务

顺序投票策略对于主库的负面影响比较严重：出于性能提升的原因，数据库的多版本并发控制（MVCC）使得不存在相互关联的事务得以并发处理，但上述顺序投票策略使得事务#5-#9可能被毫不相干的事务#4阻塞，且必须hold在内存。

顺序投票策略对于多表事务的影响很大，包括单表和多表的事务，都会被阻塞，形成一个链式反应。

顺序投票策略对于跨服务器的多表事务（分布式事务）的影响极大：由于事务日志需要在多个表相关的多台服务器之间同步，日志发送与接收之间的顺序更加得不到保证，许多的单表和多表的事务都可能被阻塞，包括链式反应的阻塞甚至循环阻塞，不仅增加事务延迟，甚至可能导致内存耗尽。

Raft的上述顺序投票策略，是Raft算法的基础之一，如果抛弃它，则Raft算法的正确性无法得到保证。对于数据库之外的场景，上述缺陷可能没有很大的影响，但对于高峰期每秒钟处理成千上万的事务的数据库，是一个无法忽视的潜在性能和稳定性风险。

除非慢节点会飘（比如5台服务器在一段时间内，轮番变成慢节点），顺序提交才会成为影响事务日志的持久化。若仅仅是固定的节点成为慢节点或故障时，raft协议瓶颈就不大了。

----------
Reference：
